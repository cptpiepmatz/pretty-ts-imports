(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,(function(r){var n=e[i][1][r];return o(n||r)}),p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){module.exports={name:"pretty-ts-imports",version:"0.1.0",description:"",main:"./dist/lib.bundle.min.js",sourceMap:"./dist/lib.bundle.min.js.map",types:"./dist/lib.d.ts",bin:{"pretty-ts-imports":"./bin/pretty-ts-imports",primp:"./bin/primp"},scripts:{test:"jasmine-ts",coverage:"nyc jasmine-ts","run-dev":"ts-node src/cli.ts",build:"npm run build:clean && npm run build:tsc && npm run build-cli:bundle && npm run build-cli:minify && npm run build-lib:bundle && npm run build-lib:minify && npm run build-lib:types","build:clean":"del-cli dist & del-cli out","build:tsc":"tsc","build-cli:bundle":"browserify out/src/cli.js --node -o dist/cli.bundle.js --no-bundle-external","build-cli:minify":"terser dist/cli.bundle.js -o dist/cli.bundle.min.js --source-map","build-lib:types":"npm-dts generate -e src/lib.ts -o dist/lib.d.ts -t tmp/dts -L warn","build-lib:bundle":"browserify out/src/lib.js --node -o dist/lib.bundle.js --no-bundle-external","build-lib:minify":"terser dist/lib.bundle.js -o dist/lib.bundle.min.js --source-map","schema:config":"typescript-json-schema src/config/Config.ts Config --tsNodeRegister -o config.schema.json",schema:"npm run schema:config",docs:"typedoc"},repository:{type:"git",url:"git+https://github.com/derPiepmatz/pretty-ts-imports.git"},author:"Tim 'Piepmatz' Hesse",license:"ISC",bugs:{url:"https://github.com/derPiepmatz/pretty-ts-imports/issues"},homepage:"https://github.com/derPiepmatz/pretty-ts-imports#readme",dependencies:{"detect-newline":"<4.0.0",json5:"^2.2.0","node-watch":"^0.7.2","require-from-string":"^2.0.2",typescript:"^4.5.2",yaml:"^1.10.2",yargs:"^17.3.0"},devDependencies:{"@types/jasmine":"^3.10.2","@types/node":"^16.11.11","@types/require-from-string":"^1.2.1","@types/yargs":"^17.0.7",browserify:"^17.0.0","del-cli":"^4.0.1",jasmine:"^3.10.0","jasmine-ts":"^0.4.0","npm-dts":"^1.3.10",nyc:"^15.1.0",terser:"^5.10.0","ts-node":"^10.4.0",typedoc:"^0.22.10","typedoc-plugin-extras":"^2.2.3","typescript-json-schema":"^0.52.0"}}},{}],2:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const helpers_1=require("yargs/helpers");const yargs_1=__importDefault(require("yargs/yargs"));const package_json_1=require("../package.json");class CLIHandler{constructor(){let yargsHelp="";const argv=(0,yargs_1.default)((0,helpers_1.hideBin)(process.argv)).scriptName("primp").usage("Usage: primp [options] <file|directory>").option({r:{type:"boolean",alias:"recursive",default:false,describe:"read the directory recursively"},o:{type:"string",alias:"output",describe:"puts the modified files there, instead of in-place"},t:{type:"string",alias:"tsconfig",describe:"path to your tsconfig"},c:{type:"string",alias:"config",describe:"path to your primp config"},w:{type:"boolean",alias:"watch",default:false,describe:"starts primp in watch mode"},_:{type:"string",demandOption:true}}).epilog(`Tool written by ${package_json_1.author}`).showHelp((help=>yargsHelp=help)).parseSync();this.givenFileOrDirPath=argv._[0];this.shallRecursive=argv.r;this.outputPath=argv.o;this.tsConfigPath=argv.t;this.primpConfigPath=argv.c;this.shallWatch=argv.w;if(!this.givenFileOrDirPath){console.log(yargsHelp);process.exit(1)}}}exports.default=CLIHandler},{"../package.json":1,"yargs/helpers":undefined,"yargs/yargs":undefined}],3:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const detect_newline_1=__importDefault(require("detect-newline"));const fs_1=require("fs");const path_1=require("path");const typescript_1=require("typescript");const CLIOptionsError_1=__importDefault(require("./errors/CLIOptionsError"));const MissingFileError_1=__importDefault(require("./errors/MissingFileError"));const Import_1=__importDefault(require("./import_management/Import"));class FileManager{constructor(tsconfigPath,filePaths){this.imports=new Map;const configPath=(0,typescript_1.findConfigFile)(tsconfigPath,FileManager.fileExists);if(!configPath)throw new MissingFileError_1.default("Couldn't find tsconfig.");this.tsConfig=(0,typescript_1.readConfigFile)(configPath,FileManager.readFile).config;filePaths=[filePaths].flat();const files=[];for(let filePath of filePaths){this.reloadFromDisk(filePath)}}reloadFromDisk(path){const fullPath=(0,path_1.resolve)(path);let content;try{content=(0,fs_1.readFileSync)(fullPath,"utf-8")}catch(e){throw new MissingFileError_1.default("Couldn't find file.",fullPath)}const sourceFile=(0,typescript_1.createSourceFile)(fullPath,content,this.tsConfig.compilerOptions.target);const imports=[];for(let statement of sourceFile.statements){if(statement.kind!==typescript_1.SyntaxKind.ImportDeclaration)break;imports.push(new Import_1.default(statement,sourceFile))}this.imports.set(fullPath,{sourceFile:sourceFile,imports:imports})}write(path,newContent,newPath){let entry=this.imports.get((0,path_1.resolve)(path));if(entry.sourceFile.text===newContent)return;const eol=(0,detect_newline_1.default)(entry.sourceFile.text)??"\n";(0,fs_1.mkdirSync)((0,path_1.dirname)(newPath??path),{recursive:true});(0,fs_1.writeFileSync)(newPath??path,newContent.replaceAll(/\r?\n/g,eol))}static fileExists(fileName){try{(0,fs_1.accessSync)(fileName);return true}catch(e){return false}}static readFile(path){try{return(0,fs_1.readFileSync)(path,"utf8")}catch(e){return}}static getFiles(path,recursive){try{const stat=(0,fs_1.statSync)(path);if(stat.isFile())return path;if(stat.isDirectory()){let filePaths=[];if(recursive){for(let innerPath of(0,fs_1.readdirSync)(path)){filePaths=filePaths.concat(FileManager.getFiles((0,path_1.join)(path,innerPath),true))}}else{for(let innerPath of(0,fs_1.readdirSync)(path)){const joinedInnerPath=(0,path_1.join)(path,innerPath);const innerStat=(0,fs_1.statSync)(joinedInnerPath);if(innerStat.isFile())filePaths.push(joinedInnerPath)}}return filePaths}}catch(e){}throw new CLIOptionsError_1.default("Given path is neither a file nor a directory.","_",path)}}exports.default=FileManager},{"./errors/CLIOptionsError":9,"./errors/MissingFileError":12,"./import_management/Import":15,"detect-newline":undefined,fs:undefined,path:undefined,typescript:undefined}],4:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const node_watch_1=__importDefault(require("node-watch"));const path_1=require("path");const CLIHandler_1=__importDefault(require("./CLIHandler"));const FileManager_1=__importDefault(require("./FileManager"));const ConfigHandler_1=__importDefault(require("./config/ConfigHandler"));const OnDemandTranspiler_1=__importDefault(require("./config/OnDemandTranspiler"));const ImportIntegrator_1=__importDefault(require("./import_management/ImportIntegrator"));const ImportSeparator_1=__importDefault(require("./import_management/ImportSeparator"));const ImportSorter_1=__importDefault(require("./import_management/ImportSorter"));const cliHandler=new CLIHandler_1.default;const{givenFileOrDirPath:givenFileOrDirPath,shallRecursive:shallRecursive,primpConfigPath:primpConfigPath,outputPath:outputPath}=cliHandler;const files=FileManager_1.default.getFiles(givenFileOrDirPath,shallRecursive);const tsConfigPath=cliHandler.tsConfigPath??process.cwd();const fileManager=new FileManager_1.default(tsConfigPath,files);const configPath=primpConfigPath??ConfigHandler_1.default.findConfig(givenFileOrDirPath);const configHandler=new ConfigHandler_1.default(configPath);const requiredRecord={};if(configPath){const onDemandTranspiler=new OnDemandTranspiler_1.default(fileManager.tsConfig,configPath);for(const[name,path]of Object.entries(configHandler.require)){requiredRecord[name]=onDemandTranspiler.transpile(path)}}const{sortImports:sortImports,sortImportElements:sortImportElements}=configHandler;const sorter=new ImportSorter_1.default(sortImports,sortImportElements,requiredRecord);const separator=new ImportSeparator_1.default(configHandler.separateBy,requiredRecord);const integrator=new ImportIntegrator_1.default(configHandler.formatting);for(let[path,{sourceFile:sourceFile,imports:imports}]of fileManager.imports.entries()){writeSorted(path,sourceFile,imports)}function writeSorted(path,sourceFile,imports){sorter.sort(imports);let integrated=integrator.integrate(sourceFile,separator.insertSeparator(imports));if(outputPath){let newPath=(0,path_1.join)(outputPath,(0,path_1.relative)(givenFileOrDirPath,path));fileManager.write(path,integrated,newPath);return}fileManager.write(path,integrated)}if(cliHandler.shallWatch){console.log("starting to watch");(0,node_watch_1.default)(files,((eventType,filePath)=>{if(eventType==="remove")return;const path=(0,path_1.resolve)(filePath);try{fileManager.reloadFromDisk(path);let{sourceFile:sourceFile,imports:imports}=fileManager.imports.get(path);writeSorted(path,sourceFile,imports)}catch(e){console.warn(e)}}))}},{"./CLIHandler":2,"./FileManager":3,"./config/ConfigHandler":5,"./config/OnDemandTranspiler":6,"./import_management/ImportIntegrator":16,"./import_management/ImportSeparator":17,"./import_management/ImportSorter":18,"node-watch":undefined,path:undefined}],5:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.expectedConfigNames=void 0;const fs_1=require("fs");const path_1=require("path");const JSON5=__importStar(require("json5"));const YAML=__importStar(require("yaml"));const defaultConfig_1=require("./defaultConfig");const SupportedConfigFormat_1=__importDefault(require("./SupportedConfigFormat"));const UnsupportedFileFormatError_1=__importDefault(require("../errors/UnsupportedFileFormatError"));exports.expectedConfigNames=["primp","pretty-ts-imports","prettyTsImports".toLowerCase()];class ConfigHandler{constructor(configPath){let config={};if(configPath){let configContent=(0,fs_1.readFileSync)(configPath,"utf-8");switch((0,path_1.extname)(configPath)){case SupportedConfigFormat_1.default.JSON:config=JSON.parse(configContent);break;case SupportedConfigFormat_1.default.JSON5:config=JSON5.parse(configContent);break;case SupportedConfigFormat_1.default.YML:case SupportedConfigFormat_1.default.YAML:config=YAML.parse(configContent);break;default:throw new UnsupportedFileFormatError_1.default(configPath)}}this.sortImports=config.sortImports??defaultConfig_1.defaultSortImports;this.sortImportElements=config.sortImportElements??defaultConfig_1.defaultSortImportElements;this.separateBy=config.separateBy??defaultConfig_1.defaultSeparateBy;this.require=config.require??{};this.formatting=Object.assign({},defaultConfig_1.defaultFormatting,config.formatting)}static isSupportedConfigFile(configPath){let ext=(0,path_1.extname)(configPath);if(Object.values(SupportedConfigFormat_1.default).includes(ext)){if(exports.expectedConfigNames.includes((0,path_1.basename)(configPath,ext).toLowerCase())){return true}}return false}static findConfig(entryPoint){let stat=(0,fs_1.statSync)(entryPoint);if(stat.isFile()){if(ConfigHandler.isSupportedConfigFile(entryPoint)){return entryPoint}}if(stat.isDirectory()){let files=(0,fs_1.readdirSync)(entryPoint);for(let file of files){if(ConfigHandler.isSupportedConfigFile(file)){return file}}let upper=(0,path_1.dirname)(entryPoint);if(upper===entryPoint){return undefined}return ConfigHandler.findConfig(upper)}return undefined}}exports.default=ConfigHandler},{"../errors/UnsupportedFileFormatError":14,"./SupportedConfigFormat":7,"./defaultConfig":8,fs:undefined,json5:undefined,path:undefined,yaml:undefined}],6:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const fs_1=require("fs");const path_1=require("path");const require_from_string_1=__importDefault(require("require-from-string"));const typescript_1=require("typescript");const OnDemandTranspileError_1=__importDefault(require("../errors/OnDemandTranspileError"));class OnDemandTranspiler{constructor(tsConfig,configPath){this.configPath=configPath;this.compilerOptions=tsConfig.compilerOptions}transpile(sourcePath){if(!this.configPath)throw new OnDemandTranspileError_1.default("No config path given");let requirePath=(0,path_1.resolve)((0,path_1.dirname)(this.configPath),sourcePath);let requireContent;try{requireContent=(0,fs_1.readFileSync)(requirePath,"utf-8")}catch(e){throw new OnDemandTranspileError_1.default("Could not read the file",requirePath)}let transpiled=(0,typescript_1.transpile)(requireContent,this.compilerOptions);let required;try{required=(0,require_from_string_1.default)(transpiled)}catch(e){throw new OnDemandTranspileError_1.default("Could not require the function",requirePath)}if(required.default)return required.default;throw new OnDemandTranspileError_1.default("Transpiled function has no default export",requirePath)}}exports.default=OnDemandTranspiler},{"../errors/OnDemandTranspileError":13,fs:undefined,path:undefined,"require-from-string":undefined,typescript:undefined}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SupportedConfigFormat;(function(SupportedConfigFormat){SupportedConfigFormat["JSON"]=".json";SupportedConfigFormat["JSON5"]=".json5";SupportedConfigFormat["YML"]=".yml";SupportedConfigFormat["YAML"]=".yaml"})(SupportedConfigFormat||(SupportedConfigFormat={}));exports.default=SupportedConfigFormat},{}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defaultFormatting=exports.defaultSeparateBy=exports.defaultSortImportElements=exports.defaultSortImports=void 0;const defaultConfig={sortImports:["sourceType","!namespacePresence","pathName","sourceName"],sortImportElements:["elementType","basenameGroup","elementName"],separateBy:["unequalPackageState","unequalNamespaceUse"],formatting:{bracketIndent:0,indent:2,maxColumns:80,quoteStyle:"double"},require:{}};exports.defaultSortImports=defaultConfig.sortImports;exports.defaultSortImportElements=defaultConfig.sortImportElements;exports.defaultSeparateBy=defaultConfig.separateBy;exports.defaultFormatting=defaultConfig.formatting;exports.default=defaultConfig},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class CLIOptionsError extends Error{constructor(message,cliOption,cliValue){super(message);this.cliOption=cliOption;this.cliValue=cliValue}}exports.default=CLIOptionsError},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class IntegrationError extends Error{constructor(message,sourceText){super(message);this.sourceText=sourceText}}exports.default=IntegrationError},{}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class InvalidConfigError extends Error{constructor(message,configKey,configValue){super(message);this.configKey=configKey;this.configValue=configValue}}exports.default=InvalidConfigError},{}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class MissingFileError extends Error{constructor(message,path){super(message);this.path=path}}exports.default=MissingFileError},{}],13:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class OnDemandTranspileError extends Error{constructor(message,path){super(message);this.path=path}}exports.default=OnDemandTranspileError},{}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});class UnsupportedFileFormatError extends Error{constructor(path){super("This file format is not supported.");this.path=path}}exports.default=UnsupportedFileFormatError},{}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const typescript_1=require("typescript");const defaultConfig_1=require("../config/defaultConfig");class Import{constructor(importDeclaration,sourceFile){this.isNamespace=false;this.isNamed=false;let sourceText=importDeclaration.moduleSpecifier.getText(sourceFile);sourceText=sourceText.substring(1,sourceText.length-1);let sourceIsRelative=sourceText.startsWith("./")||sourceText.startsWith("../");this.source={name:sourceText,isRelative:sourceIsRelative,isPackage:!sourceIsRelative};const importClause=importDeclaration.importClause;this.isTypeOnly=importClause?.isTypeOnly||false;this.elements=[];if(!importClause)return;if(importClause.name){const name=importClause.name.getText(sourceFile);this.defaultElement={name:name,isDefault:true,isWildcard:false,isRenamed:false,isType:!!name.match(/^[A-Z]/),isFunctionOrObject:!name.match(/^[A-Z]/)}}if(importClause.namedBindings){const bindings=importClause.namedBindings;switch(bindings.kind){case typescript_1.SyntaxKind.NamedImports:this.isNamed=true;for(let element of bindings.elements){const name=element.name.getText(sourceFile);let importElement={name:name,isDefault:false,isWildcard:false,isRenamed:false,isType:!!name.match(/^[A-Z]/),isFunctionOrObject:!name.match(/^[A-Z]/)};if(element.propertyName){const originalName=element.propertyName.getText(sourceFile);importElement={...importElement,...{originalName:originalName,isRenamed:true,isType:!!originalName.match(/^[A-Z]/),isFunctionOrObject:!originalName.match(/^[A-Z]/)}}}this.elements.push(importElement)}break;case typescript_1.SyntaxKind.NamespaceImport:this.isNamespace=true;const name=bindings.name.getText(sourceFile);this.elements.push({name:name,isDefault:false,isWildcard:true,isRenamed:true,originalName:"*",isType:!!name.match(/^[A-Z]/),isFunctionOrObject:!name.match(/^[A-Z]/)});break}}}sort(comparator){this.elements.sort(comparator);return this}toString(formattingOptions={indent:2,bracketIndent:0,quoteStyle:"double",maxColumns:80}){const{indent:indent,bracketIndent:bracketIndent,quoteStyle:quoteStyle,maxColumns:maxColumns}=Object.assign({},defaultConfig_1.defaultFormatting,formattingOptions);const indentString=" ".repeat(indent);const bracketIndentString=" ".repeat(bracketIndent);const quoteSymbol=quoteStyle==="double"?'"':"'";let output="import ";if(this.isTypeOnly)output+="type ";let importElements=[];if(this.defaultElement)importElements.push(this.defaultElement.name);if(this.isNamed){let namedElements=[];this.elements.forEach((element=>{if(element.isRenamed){namedElements.push(`${element.originalName} as ${element.name}`);return}namedElements.push(element.name)}));importElements.push("{"+bracketIndentString+namedElements.join(", ")+bracketIndentString+"}")}if(this.isNamespace){importElements.push(`* as ${this.elements[0].name}`)}output+=importElements.join(", ");if(this.isNamed||this.isNamespace||this.defaultElement)output+=" from ";output+=`${quoteSymbol}${this.source.name}${quoteSymbol};`;if(maxColumnsCheck(output,maxColumns)){let splitOutput=output.split(/[{}]/);if(splitOutput.length===3){let splitElements=splitOutput[1].split(", ");output=splitOutput[0]+"{\n"+indentString+splitElements.join(",\n"+indentString)+"\n}"+splitOutput[2]}}if(maxColumnsCheck(output,maxColumns)){let splitOutput=output.split(" from ");if(splitOutput.length===2){output=splitOutput[0]+"\n"+indentString+"from "+splitOutput[1]}}return output}}exports.default=Import;function maxColumnsCheck(toCheck,maxColumns){return toCheck.split("\n").some((line=>line.length>maxColumns))}},{"../config/defaultConfig":8,typescript:undefined}],16:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const typescript_1=require("typescript");const IntegrationError_1=__importDefault(require("../errors/IntegrationError"));class ImportIntegrator{constructor(formatting){this.formatting=formatting}stringifyImports(imports){let output="";for(let imported of imports){if(imported===null)output+="\n";else output+=imported.toString(this.formatting)+"\n"}return output.slice(0,-1)}integrate(sourceFile,imports){let importStart=sourceFile.text.search(/^import\s/gm);if(importStart===-1)return sourceFile.text;let importEnd=-1;for(let statement of sourceFile.statements){if(statement.kind!==typescript_1.SyntaxKind.ImportDeclaration)break;importEnd=statement.end}if(importEnd===-1){throw new IntegrationError_1.default("Couldn't find the end of imports",sourceFile.text)}return sourceFile.text.slice(0,importStart)+this.stringifyImports(imports)+sourceFile.text.slice(importEnd)}}exports.default=ImportIntegrator},{"../errors/IntegrationError":10,typescript:undefined}],17:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const InvalidConfigError_1=__importDefault(require("../errors/InvalidConfigError"));const builtinSeparateByFunctions=__importStar(require("../sort_rules/separate_by"));class ImportSeparator{constructor(separateByRules,requireFunctions){this.separateByRules=[];let separateByFunctions=Object.assign({},builtinSeparateByFunctions,requireFunctions);for(let separateByRule of separateByRules){if(!separateByFunctions[separateByRule]){throw new InvalidConfigError_1.default("Could not find separate by function.","separateBy",separateByRule)}this.separateByRules.push(separateByFunctions[separateByRule])}}decideSeparator(a,b){if(!a||!b)return false;for(let rule of this.separateByRules){if(rule(a,b))return true}return false}insertSeparator(imports){let separatedImports=[imports[0]];for(let imported of imports.slice(1)){let popped=separatedImports.pop();separatedImports.push(popped);if(this.decideSeparator(popped,imported)){separatedImports.push(null)}separatedImports.push(imported)}return separatedImports}}exports.default=ImportSeparator},{"../errors/InvalidConfigError":11,"../sort_rules/separate_by":31}],18:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;Object.defineProperty(o,k2,{enumerable:true,get:function(){return m[k]}})}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});const InvalidConfigError_1=__importDefault(require("../errors/InvalidConfigError"));const builtinImportCompareFunctions=__importStar(require("../sort_rules/compare_imports"));const builtinImportElementCompareFunctions=__importStar(require("../sort_rules/compare_import_elements"));class ImportSorter{constructor(sortImports,sortImportElements,requireFunctions){this.sortImportOrder=[];this.sortImportElementOrder=[];const importCompareFunctions=Object.assign({},builtinImportCompareFunctions,requireFunctions);const importElementCompareFunctions=Object.assign({},builtinImportElementCompareFunctions,requireFunctions);for(let[sortImport,shouldInverse]of sortImports.map(ImportSorter.shouldInverse)){if(!importCompareFunctions[sortImport]){throw new InvalidConfigError_1.default("Could not find import compare function.","sortImports",{sortImport:sortImport,shouldInverse:shouldInverse})}if(shouldInverse){this.sortImportOrder.push(ImportSorter.inverseComparator(importCompareFunctions[sortImport]))}else{this.sortImportOrder.push(importCompareFunctions[sortImport])}}for(let[sortImportElement,shouldInverse]of sortImportElements.map(ImportSorter.shouldInverse)){if(!importElementCompareFunctions[sortImportElement]){throw new InvalidConfigError_1.default("Could not find import element compare function.","sortImportElement",{sortImportElement:sortImportElement,shouldInverse:shouldInverse})}if(shouldInverse){this.sortImportElementOrder.push(ImportSorter.inverseComparator(importElementCompareFunctions[sortImportElement]))}else{this.sortImportElementOrder.push(importElementCompareFunctions[sortImportElement])}}}static shouldInverse(rule){return rule.startsWith("!")?[rule.slice(1),true]:[rule,false]}static chainCompareFunctions(sortRules){return function(a,b){for(let rule of sortRules){let result=rule(a,b);if(result!==0)return result}return 0}}static inverseComparator(comparator){return function(a,b){return-comparator(a,b)}}sort(imports){const importCompare=ImportSorter.chainCompareFunctions(this.sortImportOrder);const importElementCompare=ImportSorter.chainCompareFunctions(this.sortImportElementOrder);for(let imported of imports){imported.sort(importElementCompare)}return imports.sort(importCompare)}}exports.default=ImportSorter},{"../errors/InvalidConfigError":11,"../sort_rules/compare_import_elements":22,"../sort_rules/compare_imports":25}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const basenameGroup=function(a,b){if(a.isFunctionOrObject||b.isFunctionOrObject)return 0;const matcher=/([A-Z][a-z]*)/g;const aMatches=a.name.match(matcher);const bMatches=b.name.match(matcher);const aParts=Array.from(aMatches).reverse();const bParts=Array.from(bMatches).reverse();const partsLength=Math.min(aParts.length,bParts.length);for(let i=0;i<partsLength;i++){const comparison=aParts[i].localeCompare(bParts[i]);if(comparison!==0)return comparison}return 0};exports.default=basenameGroup},{}],20:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const elementName=function(a,b){return a.name.localeCompare(b.name)};exports.default=elementName},{}],21:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const elementType=function(a,b){const[aFunction,bFunction]=[a,b].map((m=>+m.isFunctionOrObject));return bFunction-aFunction};exports.default=elementType},{}],22:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.elementName=exports.elementType=exports.basenameGroup=void 0;var basenameGroup_1=require("./basenameGroup");Object.defineProperty(exports,"basenameGroup",{enumerable:true,get:function(){return __importDefault(basenameGroup_1).default}});var elementType_1=require("./elementType");Object.defineProperty(exports,"elementType",{enumerable:true,get:function(){return __importDefault(elementType_1).default}});var elementName_1=require("./elementName");Object.defineProperty(exports,"elementName",{enumerable:true,get:function(){return __importDefault(elementName_1).default}})},{"./basenameGroup":19,"./elementName":20,"./elementType":21}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const defaultPresence=function(a,b){const aDefault=a.defaultElement?0:1;const bDefault=b.defaultElement?0:1;return aDefault-bDefault};exports.default=defaultPresence},{}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const defaultType=function(a,b){const aDefault=a.defaultElement;const bDefault=b.defaultElement;if(!aDefault||!bDefault)return 0;const aType=aDefault.isType?0:1;const bType=bDefault.isType?0:1;return aType-bType};exports.default=defaultType},{}],25:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.sourceType=exports.namespacePresence=exports.defaultType=exports.defaultPresence=exports.sourceName=exports.pathName=exports.pathDepth=void 0;var pathDepth_1=require("./pathDepth");Object.defineProperty(exports,"pathDepth",{enumerable:true,get:function(){return __importDefault(pathDepth_1).default}});var pathName_1=require("./pathName");Object.defineProperty(exports,"pathName",{enumerable:true,get:function(){return __importDefault(pathName_1).default}});var sourceName_1=require("./sourceName");Object.defineProperty(exports,"sourceName",{enumerable:true,get:function(){return __importDefault(sourceName_1).default}});var defaultPresence_1=require("./defaultPresence");Object.defineProperty(exports,"defaultPresence",{enumerable:true,get:function(){return __importDefault(defaultPresence_1).default}});var defaultType_1=require("./defaultType");Object.defineProperty(exports,"defaultType",{enumerable:true,get:function(){return __importDefault(defaultType_1).default}});var namespacePresence_1=require("./namespacePresence");Object.defineProperty(exports,"namespacePresence",{enumerable:true,get:function(){return __importDefault(namespacePresence_1).default}});var sourceType_1=require("./sourceType");Object.defineProperty(exports,"sourceType",{enumerable:true,get:function(){return __importDefault(sourceType_1).default}})},{"./defaultPresence":23,"./defaultType":24,"./namespacePresence":26,"./pathDepth":27,"./pathName":28,"./sourceName":29,"./sourceType":30}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const namespacePresence=function(a,b){const aNamespace=a.isNamespace?0:1;const bNamespace=b.isNamespace?0:1;return aNamespace-bNamespace};exports.default=namespacePresence},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const pathDepth=function(a,b){if([a,b].some((m=>m.source.isPackage)))return 0;const[dirsA,dirsB]=[a,b].map((m=>m.source.name.split("/").length));return dirsA-dirsB};exports.default=pathDepth},{}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const path_1=require("path");const pathName=function(a,b){if([a,b].some((m=>m.source.isPackage)))return 0;const[dirsA,dirsB]=[a,b].map((m=>(0,path_1.dirname)(m.source.name).split("/")));const minLength=Math.min(dirsA.length,dirsB.length);for(let i=0;i<minLength;i++){const comparison=dirsA[i].localeCompare(dirsB[i]);if(comparison)return comparison}return 0};exports.default=pathName},{path:undefined}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const sourceName=function(a,b){if([a,b].some((m=>m.source.isRelative)))return 0;return a.source.name.localeCompare(b.source.name)};exports.default=sourceName},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const sourceType=function(a,b){const aPackage=a.source.isPackage?0:1;const bPackage=b.source.isPackage?0:1;return aPackage-bPackage};exports.default=sourceType},{}],31:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.unequalNamespaceUse=exports.unequalPackageState=void 0;var unequalPackageState_1=require("./unequalPackageState");Object.defineProperty(exports,"unequalPackageState",{enumerable:true,get:function(){return __importDefault(unequalPackageState_1).default}});var unequalNamespaceUse_1=require("./unequalNamespaceUse");Object.defineProperty(exports,"unequalNamespaceUse",{enumerable:true,get:function(){return __importDefault(unequalNamespaceUse_1).default}})},{"./unequalNamespaceUse":32,"./unequalPackageState":33}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const unequalNamespaceUse=function(l,f){return l.isNamespace!==f.isNamespace};exports.default=unequalNamespaceUse},{}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});const unequalPackageState=function(leading,following){const leadingIsPackage=leading.source.isPackage;const followingIsPackage=following.source.isPackage;return leadingIsPackage!==followingIsPackage};exports.default=unequalPackageState},{}]},{},[4]);